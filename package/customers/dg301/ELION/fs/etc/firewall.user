# This file is interpreted as shell script.
# Put your custom iptables rules here, they will
# be executed with each firewall (re-)start.

# Elion static rules

# IPv4

# deny guest access
iptables -t filter -I zone_guest_input -p tcp -m comment --comment Deny-Guest-Access -j reject
# inet wan management
iptables -I zone_wan_input -p tcp -m tcp -s 80.235.8.160/27 --dport 20022 -j ACCEPT
iptables -I zone_wan_input -p tcp -m tcp -s 80.235.8.160/27 --dport 20080 -j ACCEPT
# voip
iptables -I zone_wan_input -p tcp -m tcp -s 217.159.187.0/24 -j ACCEPT
iptables -I zone_wan_input -p udp -m udp -s 217.159.187.0/24 -j ACCEPT
iptables -I zone_wan_input -p tcp -m tcp -s 195.250.168.128/26 -j ACCEPT
iptables -I zone_wan_input -p udp -m udp -s 195.250.168.128/26 -j ACCEPT
# snmp
iptables -I zone_wan_input -p udp -m udp -s 80.235.8.160/27 --dport 161 -j ACCEPT
iptables -I zone_wan_input -p tcp -m tcp -s 80.235.8.160/27 --dport 161 -j ACCEPT
# acs
iptables -I zone_wan_input -p tcp -s 194.126.114.221 --dport 51005 -j ACCEPT
iptables -I zone_wan_input -p tcp -m tcp -s 194.126.114.220 --dport 51005 -j ACCEPT
# dhcp-c
iptables -I zone_wan_input -p udp -m udp --dport 68 -j ACCEPT
# ping
iptables -I zone_wan_input -p icmp -m icmp --icmp-type 8 -j ACCEPT
# NutiTV
# igmp drop
iptables -I zone_nutiTV_dest_ACCEPT 1 -d 239.255.255.250 -j DROP
# dhcp-c
iptables -I zone_nutiTV_input -p udp -m udp --dport 68 -j ACCEPT
# ping
iptables -I zone_nutiTV_input -p icmp -m icmp --icmp-type 8 -j ACCEPT
# sshblock
iptables -D INPUT -p tcp -m tcp --dport 22 -m state --state NEW -m recent --set --name DEFAULT --rsource
iptables -D INPUT -p tcp -m tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 10 --name DEFAULT --rsource -j DROP
iptables -D INPUT -p tcp -m tcp --dport 20022 -m state --state NEW -m recent --set --name DEFAULT --rsource
iptables -D INPUT -p tcp -m tcp --dport 20022 -m state --state NEW -m recent --update --seconds 60 --hitcount 10 --name DEFAULT --rsource -j DROP
iptables -I INPUT -p tcp -m tcp --dport 22 -m state --state NEW -m recent --set --name DEFAULT --rsource
iptables -I INPUT -p tcp -m tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 10 --name DEFAULT --rsource -j DROP
iptables -I INPUT -p tcp -m tcp --dport 20022 -m state --state NEW -m recent --set --name DEFAULT --rsource
iptables -I INPUT -p tcp -m tcp --dport 20022 -m state --state NEW -m recent --update --seconds 60 --hitcount 10 --name DEFAULT --rsource -j DROP

# IPv6

# dhcpv6
ip6tables -t filter -I zone_wan_input -p udp -s fe80::/10 -d fe80::/10 -m udp --sport 547 --dport 546 -m comment --comment Allow-DHCPv6 -j ACCEPT
# icmpv6
ip6tables -t filter -I zone_wan_input -p icmpv6 -m icmp6 --icmpv6-type 128 -m limit --limit 1000/sec -m comment --comment Allow-ICMPv6-Input -j ACCEPT
ip6tables -t filter -I zone_wan_input -p icmpv6 -m icmp6 --icmpv6-type 129 -m limit --limit 1000/sec -m comment --comment Allow-ICMPv6-Input -j ACCEPT
ip6tables -t filter -I zone_wan_input -p icmpv6 -m icmp6 --icmpv6-type 1 -m limit --limit 1000/sec -m comment --comment Allow-ICMPv6-Input -j ACCEPT
ip6tables -t filter -I zone_wan_input -p icmpv6 -m icmp6 --icmpv6-type 2 -m limit --limit 1000/sec -m comment --comment Allow-ICMPv6-Input -j ACCEPT
ip6tables -t filter -I zone_wan_input -p icmpv6 -m icmp6 --icmpv6-type 3 -m limit --limit 1000/sec -m comment --comment Allow-ICMPv6-Input -j ACCEPT
ip6tables -t filter -I zone_wan_input -p icmpv6 -m icmp6 --icmpv6-type 4/0 -m limit --limit 1000/sec -m comment --comment Allow-ICMPv6-Input -j ACCEPT
ip6tables -t filter -I zone_wan_input -p icmpv6 -m icmp6 --icmpv6-type 4/1 -m limit --limit 1000/sec -m comment --comment Allow-ICMPv6-Input -j ACCEPT
ip6tables -t filter -I zone_wan_input -p icmpv6 -m icmp6 --icmpv6-type 133 -m limit --limit 1000/sec -m comment --comment Allow-ICMPv6-Input -j ACCEPT
ip6tables -t filter -I zone_wan_input -p icmpv6 -m icmp6 --icmpv6-type 135 -m limit --limit 1000/sec -m comment --comment Allow-ICMPv6-Input -j ACCEPT
ip6tables -t filter -I zone_wan_input -p icmpv6 -m icmp6 --icmpv6-type 134 -m limit --limit 1000/sec -m comment --comment Allow-ICMPv6-Input -j ACCEPT
ip6tables -t filter -I zone_wan_input -p icmpv6 -m icmp6 --icmpv6-type 136 -m limit --limit 1000/sec -m comment --comment Allow-ICMPv6-Input -j ACCEPT
ip6tables -t filter -I zone_wan_forward -p icmpv6 -m icmp6 --icmpv6-type 128 -m limit --limit 1000/sec -m comment --comment Allow-ICMPv6-Forward -j ACCEPT
ip6tables -t filter -I zone_wan_forward -p icmpv6 -m icmp6 --icmpv6-type 129 -m limit --limit 1000/sec -m comment --comment Allow-ICMPv6-Forward -j ACCEPT
ip6tables -t filter -I zone_wan_forward -p icmpv6 -m icmp6 --icmpv6-type 1 -m limit --limit 1000/sec -m comment --comment Allow-ICMPv6-Forward -j ACCEPT
ip6tables -t filter -I zone_wan_forward -p icmpv6 -m icmp6 --icmpv6-type 2 -m limit --limit 1000/sec -m comment --comment Allow-ICMPv6-Forward -j ACCEPT
ip6tables -t filter -I zone_wan_forward -p icmpv6 -m icmp6 --icmpv6-type 3 -m limit --limit 1000/sec -m comment --comment Allow-ICMPv6-Forward -j ACCEPT
ip6tables -t filter -I zone_wan_forward -p icmpv6 -m icmp6 --icmpv6-type 4/0 -m limit --limit 1000/sec -m comment --comment Allow-ICMPv6-Forward -j ACCEPT
ip6tables -t filter -I zone_wan_forward -p icmpv6 -m icmp6 --icmpv6-type 4/1 -m limit --limit 1000/sec -m comment --comment Allow-ICMPv6-Forward -j ACCEPT
